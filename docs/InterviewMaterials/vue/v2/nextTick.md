# 异步队列更新原理

## 1、Vue2的异步更新队列如何工作？

Vue 将数据变更触发的 Watcher 更新存入队列（queueWatcher），通过 nextTick 延迟执行批处理，避免重复计算。

- 设计目标
   - 批量更新： `合并同一事件循环中的所有数据变更进行批量更新`
   - 避免重复渲染：防止频繁数据变更导致的无效渲染
   - 保证更新顺序：确保组件更新按父→子的合理顺序执行
   - 性能优化：利用微任务减少UI线程阻塞
- 异步更新优势
  - 连续多次修改，只会触发一次更新


## 2、nextTick的实现原理是什么？

- 收集所有修改内容，但不会立即更新
- 把更新任务放进一个"待办事项列表"
- 安排一个最快的调度去执行 `选择一个最快的送货方式`
  - 首选快递（微任务）​：Promise.then （外卖小哥）
  - 备选快递（微任务）​：MutationObserve (同城快递)
  - 普通快递（宏任务）​：setTimeout (邮政快递)


**nextTick执行时机**

在当前同步代码执行完后，在所有微任务之前，DOM已经更新完成
- 与Promise的区别：nextTick回调比Promise.then更早执行
- 与setTimeout的区别：比所有宏任务都早执行
